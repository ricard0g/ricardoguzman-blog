---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import "../assets/app.css";
import BlogSearchList from "../components/blog/BlogSearchList";

const posts = await getCollection("blogCollection");
const POSTS_PER_PAGE = 5;

const sortedPosts = [...posts].sort((a, b) => {
	return (
		new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
	);
});

const totalPages = Math.max(1, Math.ceil(sortedPosts.length / POSTS_PER_PAGE));
const serializedPosts = sortedPosts.map((post) => ({
	slug: post.data.slug,
	title: post.data.title,
	description: post.data.description,
	pubDate: post.data.pubDate.toISOString(),
	pubDateString: post.data.pubDateString,
	tags: post.data.tags,
}));
---

<Layout
	title="Blog"
	description="Browse all blog posts by Ricardo Guzman on software, AI, and personal learnings."
>
	<div class="flex flex-col items-center justify-center mt-[100px]">
		<BlogSearchList
			client:load
			posts={serializedPosts}
			title="Blog Posts"
			totalPages={totalPages}
			initialVisibleCount={POSTS_PER_PAGE}
			basePath="/blog"
		/>
	</div>
</Layout>
